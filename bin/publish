#!/usr/bin/env coffee
[interpreter, script, accessKeyId, secretAccessKey, region, source, destination] = process.argv

{parse} = require "c50n"
{read} = require "fairmont"
{resolve, dirname} = require "path"
Publisher = require "../src/publisher"

if process.argv.length == 3
  optionsFile = resolve process.cwd(), accessKeyId
  optionsDir = dirname optionsFile
  {options} = parse(read(optionsFile))
  options.source = resolve(optionsDir, options.source) if options.source?
  options.compressedDir = resolve(optionsDir, options.compressedDir) if options.compressedDir?
else
  unless accessKeyId? and secretAccessKey? and region? and source? and destination?
    console.log ""
    console.log "Usage:"
    console.log "         bin/publish s3-access-key-id s3-secret-access-key s3-region source-dir destination-s3-bucket"
    console.log "or"
    console.log "         bin/publish path/to/options.cson"
    console.log ""
    return

  options = {
    accessKeyId
    secretAccessKey
    region
    source
    destination
    s3Options: {}
  }

publisher = new Publisher options
publisher.publish options
